services:
  pytorch-nvidia-app:
    container_name: pytorch-nvidia-app
    build:
      context: ..
      # Use a specific Dockerfile, basic or pytorch
      dockerfile: pytorch/Dockerfile

    # Use the image for faster startup - comment out the build section above if using this.
    # image: "pytorch/ngc/devcontainer"
    restart: unless-stopped
    volumes:
      - ../..:/workspaces:cached

    # Enable GPU support
    deploy:
          resources:
            reservations:
              devices:
                - driver: nvidia
                  count: all # Ou o número de GPUs que você precisa
                  capabilities: [gpu]

    # Overrides default command so things don't shut down after the process ends.
    command: sleep infinity

    # Use "forwardPorts" in **devcontainer.json** to forward an app port locally.
    # (Adding the "ports" property to this file will not forward from a Codespace.)

    # Runs app on the same network as the database container, 
    # allows "forwardPorts" in devcontainer.json function.
    # network_mode: service:py-postgre

    networks:
      - pytorch-nvidia-network

networks:
  pytorch-nvidia-network:
    driver: bridge

